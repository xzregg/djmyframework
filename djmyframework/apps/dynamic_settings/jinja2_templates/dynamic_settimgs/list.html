{% extends "framework/base.html" %}

{% block header %}
    <title>{{ _('系统配置 列表') }}</title>

{% endblock %}


{% block content %}
    <div id="vue-container" v-cloak="">
        <div class="row header">
            <div class="col-sm-5">
                <h1>{{ _('系统配置') }}
                    <small>{{ _('列表') }}</small>
                </h1>
            </div>
        </div>

        <form id="filter-form" class="form-inline">
            <div class="row ">
                <div class="col-sm-3">
                    <template>
                        <a-anchor>
                            <a-anchor-link v-for="(items, key) in groupOptionsMap"
                                           a-anchor-link
                                           :href="'#'+key"
                                           :title="key">
                                <a-anchor-link v-for="(item, i) in items" :href="'#'+item.name" :title="item.alias"/>

                            </a-anchor-link>


                        </a-anchor>
                    </template>
                </div>

                <div class="col-sm-4">

                    <a-card v-for="(items, key) in groupOptionsMap"
                            :id="key" :title="key" :bordered="false">

                        <a-form>
                            <a-form-item v-for="(item, i) in items">
                                <span :id="item.name" slot="label">((item.alias))</span>
                                <a-input v-model="item.value" :allow-clear="true" @change="changeSettings(item)"/>
                            </a-form-item>

                        </a-form>


                    </a-card>

                </div>


            </div>
            <br>
            <div class="row pane edit-save-bar">
                <div class="col-sm-offset-3 col-sm-9">
                    <input id="reset-btn" class="btn btn-default" type="reset" value="{{ _('重 置') }}">
                    <button @click="saveSettings(true)"
                            :disabled="isExecuting"
                            class="btn btn-primary "
                            type="button">
                        {{ _('保 存') }}
                    </button>

                </div>
            </div>
        </form>
    </div>

    <script>
        var group_options_map = Object.assign({{ data|json_dumps|safe }})

        var vue_app = new Vue({
            el: '#vue-container',
            delimiters: ['((', '))'],
            data() {
                return {
                    groupOptionsMap: group_options_map,
                    postData: {},
                    isExecuting: false,

                };
            },
            computed: {},
            methods: {
                changeSettings(item) {
                    this.postData[item.name] = item.value
                },
                saveSettings() {
                    $.post('{{ url('dynamic_settings.save') }}', JSON.stringify({settings_data: this.postData}), (rsp) => {

                        this.$message.success(rsp.msg)
                        this.postData = {}

                    }, 'json')
                },
            },
            mounted: function () {

            }

        })

    </script>
{% endblock %}